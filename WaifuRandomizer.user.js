// ==UserScript==
// @name         Waifu Randomizer
// @namespace    http://tampermonkey.net/
// @version      0.3
// @description  Makes repetition less repetitive, one girl at a time.
// @author       ADGenerit
// @match        http*://*.haremheroes.com/*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=nutaku.net
// @grant        none
// ==/UserScript==
// Places to add functionality: during champion fights, viewing profiles

// Some Settings
// If you want your main waifu to show up by default, you can set this to false
let waifu_randomize_on_start = true
let other_randomize_on_start = true
// If you want randomized girls to start at any level of dress, set these to false
// waifu is the girl on the main page, other is for every other place.
let waifu_start_dressed = false
let other_start_dressed = true
// enable or disable clicking to re-randomize
let waifu_randomize_on_click = true
let other_randomize_on_click = false
// enable or disable mouse-wheel cycling
let waifu_cycle_on_scroll = true
let other_cycle_on_scroll = true


let page_selector = "#hh_hentai";
let waifu_selector = "#homepage > div.main-container > div.middle-container > div.waifu-and-right-side-container > div.waifu-container > img";

let popup_selector_no_energy_quest = "#no_energy_quest > img";
let popup_selector_no_energy_fight = "#no_energy_fight > img";
let popup_selector_activities = "#daily_goals > div > div.daily-goals-right-part > div.timer-girl-container > img";

let market_selectors = ["#equipement-tab-container > div.right-container > div.my-inventory-container > div.market-girl-container > img",
                        "#boosters-tab-container > div.right-container > div.my-inventory-container > div.market-girl-container > img",
                        "#books-tab-container > div.right-container > div.my-inventory-container > div.market-girl-container > img",
                        "#gifts-tab-container > div.right-container > div.my-inventory-container > div.market-girl-container > img"];

let battle_girl_selector_opp = "#battle > div > div.new-battle-hero-container.new-battle-opponent > div.new-battle-hero-team-container > div.new-battle-girl-container > img.new-battle-image.position-";
let battle_girl_selector_player = "#battle > div > div.new-battle-hero-container.new-battle-player > div.new-battle-hero-team-container > div.new-battle-girl-container > img.new-battle-image.position-";

let champions_selector = "#contains_all > section > div.champions-over__champion-wrapper.champions-animation > img.champions-over__girl-image"
let pantheons_selector = "#pantheon_tab_container > div.team-girl-container > div.girl-"

let world_girl_selector = "#worldmap > div.girl_world > img";

let img_URI = "https://hh.hh-content.com/pictures/girls/";

// updated 6-27-2024
const waifu_list = {1: 5, 4: 5, 7: 5, 15: 5, 8: 5, 10: 3, 125: 3, 9: 3, 127: 3, 5: 5, 26: 3, 13: 3, 85: 5, 123: 3, 114: 5, 11: 5, 117: 3, 14: 5, 136: 3, 17: 5, 131: 3, 28: 3, 30: 3, 120: 3, 27: 5, 29: 5, 12: 3, 122: 3, 4501636: 3, 19: 5, 137: 3, 140: 3, 84: 3, 142: 3, 38: 5, 40: 3, 33: 3, 34: 3, 148: 3, 16: 3, 6: 5, 63: 3, 144: 3, 149: 3, 18: 3, 67: 3, 83: 5, 245272: 3, 7402000: 3, 39: 5, 3461743: 3, 41: 3, 74: 3, 6350074: 3, 2408483: 3, 31: 3, 6391374: 3, 823452: 5, 113: 5, 77: 3, 81: 3, 64: 5, 4439873: 3, 185685: 3, 3592385: 3, 185682: 3, 90: 5, 88: 3, 118816: 5, 1247315: 5, 6706949: 3, 1594830: 3, 7690841: 3, 96: 3, 99: 3, 4649579: 3, 4990827: 3, 73: 3, 1850048: 3, 4681481: 3, 3487965: 3, 665374: 3, 5508911: 5, 101: 3, 105: 3, 9583539: 3, 5194630: 3, 115: 3, 4371989: 3, 5052484: 3, 7968301: 3, 107: 5, 111: 3, 932583: 3, 8522440: 3, 9320650: 3, 87: 3, 24: 3, 86: 3, 1961491: 5, 520339: 3, 1978042: 3, 7076040: 3, 134: 3, 5130646: 3, 121: 3, 6496077: 3, 133: 3, 3810634: 3, 8355621: 3, 6299185: 3, 986125: 5, 727743029: 3, 736765043: 3, 116: 3, 704754895: 3, 1782274: 5, 150: 3, 3778857: 3, 624471: 3, 46754067: 3, 562631957: 3, 327934815: 3, 55: 3, 53: 3, 4479579: 3, 1379661: 5, 1800186: 3, 592213971: 5, 4469169: 3, 838868621: 3, 10360354: 3, 643075017: 3, 66: 3, 68: 3, 860296758: 3, 5709880: 3, 59725438: 3, 687036996: 3, 685229708: 3, 72: 3, 494786419: 5, 4423654: 5, 15951041: 3, 964256986: 3, 5063073: 3, 4181591: 3, 714730362: 3, 975400096: 3, 79: 3, 24316446: 5, 421534237: 3, 501847856: 3, 2914195: 3, 3192749: 3, 219651566: 3, 499134799: 3, 117998633: 3, 403278708: 3, 517842784: 3, 163610943: 3, 92: 3, 91: 3, 860882781: 5, 185692: 3, 536667824: 3, 75298829: 3, 275558038: 3, 264677345: 3, 421152517: 3, 95: 3, 117254170: 3, 914280820: 3, 416752791: 3, 318210254: 3, 502491833: 3, 82784979: 3, 102: 5, 694101623: 3, 548314009: 3, 3347017: 3, 506006967: 3, 232539523: 3, 174770201: 3, 182434719: 3, 60141518: 3, 109: 3, 249008995: 3, 992342679: 3, 399638608: 3, 117171954: 3, 11447714: 5, 303932559: 3, 11050672: 3, 485628181: 3, 22: 3, 128: 3, 677556913: 3, 933106455: 3, 672380855: 5, 792941188: 3, 599714884: 3, 19914622: 3, 225365882: 5, 478693885: 3, 231765083: 3, 636165504: 3, 9727040: 3, 404563005: 5, 130: 3, 433634874: 5, 244436510: 3, 664769262: 3, 815620579: 3, 136448909: 3, 7270263: 3, 46227677: 3, 567655: 3, 267784162: 3, 862206573: 3, 35: 3, 138: 3, 780596681: 3, 983321465: 3, 972106555: 3, 522806488: 3, 574999305: 3, 6806743: 3, 983204511: 3, 123777875: 5, 818892407: 3, 286746447: 3, 723914980: 3, 675373413: 3, 979916751: 3, 289612833: 3, 726546219: 3, 147550815: 3, 204826357: 3, 719209754: 3, 383709663: 3, 460084446: 3, 7096724: 3, 8305468: 3, 401924053: 3, 389646175: 3, 924298645: 3, 1866692: 3, 288304117: 3, 754880300: 3, 6926841: 3, 303386188: 5, 8312397: 3, 359101438: 3, 70: 3, 65: 3, 876170784: 3, 21: 3, 622421497: 3, 453010364: 3, 151048393: 3, 7749523: 3, 730158940: 3, 134803882: 3, 6076580: 3, 56889191: 3, 624080134: 3, 650749563: 3, 92792577: 3, 113889929: 3, 601493685: 3, 18823844: 3, 168952881: 3, 86216019: 3, 819478501: 3, 5550740: 3, 910124236: 3, 379441499: 3, 82: 3, 366661232: 5, 655787671: 3, 480372946: 3, 764572122: 3, 213798393: 3, 536371633: 3, 20: 3, 7914892: 3, 415943051: 3, 976276200: 3, 9870237: 3, 670796781: 3, 8556167: 3, 7220752: 3, 356909834: 3, 614251920: 3, 612527302: 3, 784911160: 3, 814598140: 5, 752004148: 3, 170887253: 3, 406004250: 3, 521620218: 1, 257237654: 3, 196005869: 3, 980529943: 3, 577947305: 3, 374621675: 3, 4749652: 3, 800408516: 3, 337307037: 1, 145: 3, 322104464: 3, 610468472: 3, 690501358: 3, 190003122: 3, 732266853: 3, 492182067: 3, 368538756: 5, 875252441: 1, 121526918: 1, 432785299: 3, 140892701: 3, 260798642: 1, 721500039: 3, 989250563: 3, 765882975: 5, 174089401: 3, 932809282: 3, 608480884: 5, 338768288: 3, 340005148: 3, 237714084: 1, 984302636: 3, 56: 3, 624681714: 3, 226927103: 5, 184697403: 3, 162119788: 3, 318292466: 3, 270574600: 6, 670829533: 3, 411168598: 1, 574378433: 5, 718124493: 1, 936580004: 3, 818115976: 5, 595247292: 3, 938541558: 3, 971949336: 3, 257265423: 3, 893876927: 3, 562842298: 1, 757554008: 3, 852204225: 3, 209575932: 3, 141694172: 3, 796746027: 5, 713468897: 5, 589505004: 3, 513698717: 3, 245996474: 1, 47504965: 3, 891519491: 3, 408617311: 3, 108555801: 3, 465519606: 5, 366964456: 3, 821124406: 3, 867299550: 3, 223049649: 3, 267120960: 3, 948443498: 6, 371808230: 5, 361856922: 3, 253710053: 5, 780618756: 3, 800186798: 3, 625456171: 3, 155415482: 3, 143174984: 5, 945881286: 3, 474799411: 6, 757382934: 3, 858779460: 5, 857588255: 3, 764300822: 3, 409772549: 3, 878748557: 3, 298684036: 3, 198256147: 5, 35537330: 3, 509881181: 1, 857360748: 1, 678759622: 3, 761713654: 1, 716813854: 1, 791142788: 3, 647838771: 3, 406380563: 3, 646301487: 3, 998175673: 3, 126333109: 3, 151980856: 5, 571335659: 1, 272069272: 3, 603140178: 3, 75: 3, 554093133: 3, 108665534: 3, 843521437: 3, 605357496: 3, 417273106: 1, 666388060: 5, 192995661: 3, 983468412: 3, 457941727: 3, 983481774: 3, 967164534: 6, 985085118: 3, 764090161: 5, 22907070: 3, 353756349: 3, 592167395: 3, 184704592: 5, 793886218: 3, 371785338: 3, 332279747: 3, 593993851: 3, 468780938: 3, 337075875: 1, 355349105: 1, 831126711: 3, 430507554: 3, 554327702: 3, 740035759: 1, 500545889: 3, 905806948: 1, 389187143: 3, 201751118: 5, 280552772: 3, 395609649: 3, 955899611: 3, 960719275: 5, 825812525: 3, 78: 3, 827706883: 3, 80: 3, 249762992: 5, 232561529: 3, 131219182: 3, 439214232: 3, 176234245: 3, 958990809: 3, 711654325: 3, 878380381: 3, 241924140: 1, 187781287: 1, 989018380: 1, 637461002: 1, 764232897: 1, 153263082: 3, 125597344: 6, 117857006: 3, 468341043: 1, 808887148: 5, 386613155: 3, 5351113: 3, 667577743: 3, 951438376: 3, 326251780: 3, 900557056: 3, 379368666: 3, 689670780: 3, 432304565: 1, 487866457: 3, 933868017: 5, 253482741: 3, 845216746: 1, 701307132: 3, 183533070: 5, 723284123: 3, 385177117: 3, 280477724: 3, 887818119: 3, 786443863: 3, 690781602: 3, 167129674: 5, 294359258: 1, 999057619: 3, 107891324: 3, 569358314: 1, 429880234: 1, 611416243: 3, 379609341: 3, 501214311: 3, 310536547: 3, 517209429: 3, 133884069: 3, 707570454: 5, 978524018: 3, 182312541: 3, 980555285: 1, 343275594: 1, 659741171: 3, 461902896: 3, 305268274: 3, 760586589: 3, 354954643: 3, 457430764: 3, 848469425: 3, 495660327: 3, 573030517: 3, 596614715: 3, 645849707: 3, 730648155: 5, 165476006: 3, 476029320: 3, 104514655: 3, 681119670: 3, 481808239: 3, 557075385: 5, 691716890: 3, 829282228: 3, 609627220: 3, 858180387: 3, 787028069: 3, 677448277: 3, 925909727: 3, 178022829: 5, 561248662: 5, 305244430: 1, 851821266: 1, 935070028: 1, 193875976: 1, 784545080: 1, 704181064: 3, 832955581: 3, 489071923: 1, 176362122: 1, 363828557: 3, 234544154: 3, 341858038: 3, 368907903: 3, 888659495: 3, 917446702: 3, 400204471: 3, 542006481: 3, 369539939: 3, 560126768: 3, 139: 3, 918449294: 1, 887326157: 3, 902429918: 3, 36: 3, 599509963: 3, 148292388: 1, 890483439: 1, 653094099: 1, 366601555: 1, 670655856: 3, 473489226: 1, 345655744: 3, 298984036: 3, 692648925: 1, 502615108: 3, 934338214: 3, 976013156: 5, 464484294: 3, 233234384: 3, 491859870: 3, 891939804: 5, 216504878: 1, 759257810: 3, 763020698: 3, 505851886: 3, 474124706: 3, 379481580: 5, 861213692: 3, 290610193: 3, 323032365: 3, 549968181: 5, 892435291: 5, 249793596: 3, 657929024: 3, 792957451: 3, 682099214: 1, 220047455: 1, 589404191: 1, 256736498: 3, 534307574: 3, 676016687: 5, 970830265: 3, 463809882: 1, 467598475: 5, 479475771: 5, 803050149: 3, 781764825: 3, 334872149: 5, 166051890: 1, 842828923: 1, 927192363: 3, 630798090: 3, 112844707: 3, 384892808: 5, 110073236: 3, 462083483: 3, 767778577: 3, 920798676: 3, 118122154: 3, 301432116: 3, 911391645: 1, 978499776: 1, 146897129: 1, 356123130: 1, 744413292: 1, 854206946: 1, 339136733: 1, 370627539: 1, 283763414: 1, 509808558: 1, 627344272: 3, 220570307: 1, 441797927: 1, 308216515: 5, 702001603: 3, 890070397: 3, 352976249: 3, 220266977: 1, 540520363: 3, 868133019: 3, 811703858: 3, 632284783: 5, 978091801: 1, 222645145: 5, 686279683: 5, 688644882: 5, 942991889: 5, 404975863: 3, 452539109: 3, 170458778: 3, 257408491: 3, 971787651: 3, 906962885: 3, 831650623: 3, 601605795: 3, 630342016: 3, 360456253: 6, 447396000: 3, 23: 3, 518464199: 3, 777177842: 3, 463778399: 3, 819926774: 3, 281707013: 5, 488466924: 3, 2873095: 3, 54: 3, 505479710: 5, 891949947: 3, 734825425: 3, 998260995: 3, 6757959: 3, 567684726: 3, 147: 3, 46792511: 3, 515355536: 5, 997792173: 5, 604215327: 3, 167231135: 3, 549524850: 3, 2124311: 3, 865503896: 5, 167573152: 3, 376374790: 6, 707703513: 5, 488584286: 3, 690645314: 6, 132725434: 5, 309097753: 6, 328223265: 6, 339916477: 5, 403516227: 3, 100895528: 3, 111649228: 3, 204655278: 3, 412577818: 3, 541829724: 5, 784404844: 3, 794976794: 3, 955068759: 5, 491645076: 3, 301227806: 3, 372106614: 6, 455833593: 6, 280940356: 3, 192431619: 3, 886658459: 6, 354515146: 5, 2570504: 3, 6236761: 3, 334495317: 3, 629931251: 5, 1403357: 3, 9551187: 3, 184523411: 3, 344662796: 6, 143960742: 6, 746356597: 3, 86962133: 3, 237064517: 3, 392608379: 3, 272939417: 5, 89: 3, 7675386: 3, 560979916: 3, 532206583: 5, 284483399: 3, 329349764: 5, 617303855: 6, 864899873: 3, 243793871: 3, 938047910: 3, 3: 3, 25: 3, 32: 3, 37: 3, 52: 3, 57: 3, 69: 3, 71: 3, 76: 3, 97: 3, 98: 5, 100: 3, 103: 3, 104: 3, 106: 3, 108: 3, 110: 3, 112: 3, 118: 3, 119: 3, 124: 3, 126: 3, 129: 3, 132: 3, 135: 3, 141: 3, 146: 3, 185688: 3, 583829: 3, 658873: 3, 986635: 3, 1060031: 3, 1699198: 3, 2116037: 3, 2142530: 3, 2344194: 3, 2880778: 3, 3315537: 3, 3559077: 3, 4607416: 3, 4938798: 3, 5186956: 3, 5427935: 3, 5537515: 3, 5555223: 3, 5871408: 3, 6022304: 3, 6144314: 3, 6244300: 3, 6348256: 3, 6674577: 3, 6714280: 3, 6747339: 3, 7188441: 3, 7356321: 3, 8135851: 3, 8514605: 3, 8701827: 3, 9414986: 3, 9658744: 3, 12188250: 5, 15949512: 3, 16293198: 5, 22938376: 3, 28520386: 3, 29350410: 3, 31155264: 3, 31751558: 3, 39247485: 3, 39692367: 3, 40475578: 3, 40645920: 3, 41414350: 5, 50249610: 3, 51725697: 3, 52332845: 3, 54950499: 3, 55534605: 3, 57901975: 3, 63323820: 3, 73168419: 3, 75096094: 3, 75674096: 3, 75872587: 3, 78325027: 3, 84718894: 3, 90685795: 3, 92391709: 3, 98258867: 3, 100029886: 3, 101214651: 3, 101336873: 5, 101546519: 1, 101695985: 3, 102210316: 3, 102212292: 3, 102656343: 3, 103402423: 5, 103435540: 5, 104242609: 3, 105313446: 3, 106106976: 5, 108359749: 5, 110570736: 3, 110876396: 5, 112655261: 5, 112783292: 3, 113657873: 5, 114595220: 3, 116065227: 3, 116146810: 5, 116494844: 3, 117731365: 3, 118563600: 3, 119423691: 3, 119765678: 3, 119794947: 3, 121104771: 3, 121414302: 5, 123164298: 1, 123295693: 3, 123649198: 3, 123817941: 3, 123910796: 3, 125181069: 3, 127388719: 3, 127599025: 3, 127817836: 3, 131250977: 3, 131512895: 5, 132027269: 3, 132770548: 3, 134278136: 3, 134507204: 3, 134645376: 3, 135041554: 3, 135241949: 3, 137814294: 3, 139112131: 3, 140121431: 5, 140157430: 3, 140861400: 3, 140985783: 3, 141010267: 3, 141318699: 3, 142689341: 5, 145462484: 3, 145551228: 3, 147095407: 3, 147538313: 3, 148261385: 3, 148437529: 3, 148900886: 3, 149049527: 1, 149730946: 3, 150227774: 3, 151242794: 3, 151672777: 5, 152200016: 3, 152277744: 3, 152825005: 3, 155521401: 3, 158261740: 3, 158656075: 5, 159216754: 5, 159391788: 3, 159410413: 5, 161179255: 3, 161182645: 3, 162104433: 3, 162456648: 3, 164866290: 3, 166042424: 3, 166065491: 3, 168323791: 3, 168519661: 3, 169671372: 3, 170065678: 3, 170655239: 5, 171122402: 3, 171199157: 3, 171638932: 3, 171879738: 3, 172428998: 3, 173444197: 3, 174129042: 3, 175397020: 3, 175523492: 5, 177740851: 3, 179230540: 5, 179444457: 3, 179923003: 3, 179993495: 3, 180569731: 3, 180824362: 3, 181032484: 3, 182071044: 3, 182136420: 1, 182688232: 3, 183174601: 3, 183811497: 3, 184770510: 3, 185908345: 3, 186022587: 3, 186473547: 5, 187713212: 3, 188681610: 3, 188928925: 3, 190367872: 5, 191527614: 3, 192365068: 3, 194105489: 1, 195354477: 3, 197266429: 3, 197515689: 3, 197652898: 5, 198028600: 5, 198183250: 5, 198860943: 3, 199081055: 5, 199686770: 6, 199873847: 3, 201269886: 5, 202241657: 3, 202274161: 3, 202769961: 3, 202895194: 5, 202953456: 3, 203831935: 3, 203905636: 3, 206065449: 3, 207817980: 3, 209132540: 3, 212536947: 3, 212598504: 3, 213233570: 1, 213829821: 3, 215540213: 3, 217603698: 5, 217744811: 3, 218769801: 5, 219809808: 1, 220213626: 3, 223668695: 3, 224003773: 3, 225777755: 6, 227708231: 3, 228261011: 3, 229275194: 5, 230300612: 3, 230575971: 6, 230856770: 5, 231061187: 3, 231994155: 3, 232057287: 3, 232388809: 3, 232680733: 3, 234327803: 3, 234757405: 3, 235369620: 3, 235456375: 5, 235942409: 5, 237137080: 6, 237336814: 3, 237424748: 3, 237726478: 1, 238107313: 3, 238666485: 3, 242056241: 5, 242288749: 3, 243209857: 5, 244232557: 3, 245500471: 5, 245773285: 3, 246106582: 3, 247281495: 3, 247829390: 3, 248462942: 3, 248746187: 3, 254802615: 3, 254938037: 3, 255202745: 1, 256399243: 3, 256698690: 3, 258073784: 3, 259988601: 3, 261152588: 5, 261735318: 3, 261821139: 3, 262165895: 3, 262515742: 3, 262970938: 1, 263477854: 3, 265591616: 3, 265664148: 3, 268483152: 5, 269244980: 3, 269322797: 3, 269324713: 1, 270043522: 3, 271344147: 5, 271488389: 3, 274230566: 5, 274384625: 3, 274620550: 5, 275226156: 3, 277756082: 3, 278921446: 5, 279051760: 3, 279076793: 3, 279153589: 3, 279721421: 3, 279831157: 3, 280048191: 1, 280313988: 3, 280623013: 5, 281315302: 3, 282027382: 3, 282718013: 3, 282837777: 3, 284293591: 3, 284796295: 3, 285063282: 3, 285164334: 3, 285673373: 3, 285711374: 5, 286226654: 5, 287164248: 3, 288218459: 5, 288907522: 3, 289764092: 1, 291291023: 3, 292154177: 3, 292927440: 3, 293001799: 3, 293173456: 6, 293470589: 3, 294753409: 3, 294844415: 3, 295630004: 3, 297485931: 3, 299651018: 3, 300193885: 3, 301061474: 3, 301274089: 3, 303014812: 3, 303307827: 3, 303325744: 3, 304395913: 3, 305959627: 3, 307345272: 3, 307511214: 3, 308153360: 3, 308740217: 3, 308820083: 3, 311587331: 3, 311970817: 3, 312634530: 3, 317976185: 3, 319457438: 3, 320203436: 3, 320916896: 5, 323149196: 3, 323758243: 3, 323883751: 3, 326855004: 6, 327262174: 3, 329223264: 3, 329623352: 3, 330433835: 3, 330911919: 6, 331234145: 3, 333072555: 3, 333287277: 3, 333811970: 5, 334240602: 3, 334548028: 3, 334811189: 3, 335612994: 5, 336495588: 3, 336970276: 3, 337047153: 5, 338343228: 3, 338865315: 3, 339186783: 5, 339765042: 3, 341495974: 3, 341708508: 3, 341843558: 3, 342245239: 3, 343146327: 3, 343824610: 3, 344672709: 5, 344730128: 3, 349243331: 5, 349932316: 3, 350224451: 3, 351362651: 3, 351467694: 3, 352733978: 6, 354002053: 3, 354771682: 3, 355999354: 5, 357027507: 3, 357952899: 5, 359909066: 3, 360998465: 3, 361709468: 3, 363164214: 3, 363410486: 3, 364164964: 5, 364398698: 6, 364818302: 3, 365246443: 3, 367801133: 3, 369900311: 3, 370847369: 3, 371595204: 6, 373179432: 5, 373715450: 3, 375070840: 5, 376960638: 3, 377640330: 3, 381030556: 3, 381298668: 6, 381788134: 3, 382405661: 3, 384008978: 3, 384221348: 3, 384280485: 3, 386453583: 1, 386726921: 3, 387271534: 3, 387825034: 1, 389689557: 5, 390005417: 3, 390295886: 5, 391244523: 5, 391544613: 3, 391649924: 3, 393217030: 3, 393351313: 3, 393777018: 3, 394245750: 3, 394364553: 3, 394527284: 3, 395105554: 5, 396260854: 3, 397002720: 3, 397944468: 3, 399241010: 3, 400631910: 3, 400744353: 3, 400757031: 5, 401610760: 3, 404568537: 3, 405862379: 3, 406907792: 3, 409146033: 3, 409189679: 3, 410900128: 3, 411487595: 3, 411880613: 5, 413121182: 3, 413198545: 3, 416286273: 3, 417520937: 5, 419029136: 3, 421452926: 3, 421571116: 3, 421973208: 3, 423714615: 3, 423864623: 6, 424293318: 3, 424954495: 3, 425348229: 3, 425768136: 3, 426595710: 3, 426888394: 3, 428748558: 3, 429203875: 3, 431571411: 3, 431766453: 3, 432995819: 3, 434420415: 3, 434436290: 3, 435940834: 3, 437113980: 1, 437410048: 5, 437832992: 3, 438195483: 3, 438295652: 1, 439656922: 3, 439722296: 3, 440391502: 5, 443582043: 3, 445411473: 3, 445743639: 6, 446417305: 5, 448759162: 3, 449136894: 3, 449894254: 3, 451625351: 6, 451654840: 5, 451783041: 3, 451972896: 5, 452255257: 1, 452880136: 3, 453044012: 3, 453059647: 5, 455165100: 3, 455440242: 3, 457897278: 5, 460717998: 3, 461889932: 3, 463187970: 3, 463570079: 5, 463888421: 3, 463975145: 3, 466400111: 3, 466703403: 3, 466845741: 3, 466853745: 3, 467093623: 3, 467286929: 3, 467396253: 1, 467443840: 3, 467978971: 3, 468200724: 3, 468362578: 3, 469033939: 3, 470838671: 3, 471006831: 3, 471026733: 3, 472868952: 3, 475253757: 3, 475399274: 3, 475674839: 3, 476280150: 5, 477208437: 3, 479389794: 3, 480841519: 3, 482331476: 3, 482651255: 3, 484491115: 3, 484585603: 5, 485315829: 5, 485318235: 3, 485598844: 3, 487855648: 1, 488816459: 3, 489180795: 5, 489334320: 3, 489428545: 3, 490163433: 5, 491003975: 3, 491695663: 3, 492529503: 3, 494054090: 3, 495240578: 3, 495322023: 5, 497247295: 3, 498490862: 3, 499469370: 3, 500514329: 3, 502045434: 3, 503676819: 5, 503862914: 5, 504473319: 3, 505076156: 3, 505202122: 3, 505531249: 3, 505617446: 3, 505691438: 3, 507287038: 3, 507945521: 6, 508651957: 3, 509268667: 3, 511246909: 3, 511344573: 3, 512054332: 3, 512498327: 5, 513359620: 1, 513917001: 3, 514166767: 3, 514986107: 3, 515677046: 3, 517249392: 3, 517257159: 1, 517335455: 3, 518603558: 5, 518685718: 5, 519983843: 3, 522519523: 3, 523709109: 5, 524196702: 3, 524990778: 1, 525456695: 5, 525478506: 3, 526454162: 3, 526739830: 3, 526860507: 3, 528447543: 5, 529513612: 3, 530721638: 3, 530935627: 5, 531119644: 5, 532422115: 3, 533005999: 5, 533529658: 5, 535916177: 3, 536311105: 3, 536361248: 3, 537542594: 3, 538399332: 5, 538753178: 3, 538820286: 3, 542089057: 3, 543624951: 3, 543693194: 1, 543840879: 3, 544390613: 5, 546122605: 3, 547099506: 3, 547500030: 3, 549658297: 5, 550480951: 5, 550510271: 3, 550721442: 3, 550842002: 6, 553023528: 3, 553064205: 3, 553204100: 3, 554348711: 3, 557123694: 3, 559136208: 1, 559518477: 3, 560469774: 3, 561207936: 3, 561569496: 3, 565203585: 1, 566329854: 3, 566663976: 5, 567258822: 3, 567830538: 3, 570228290: 3, 570363501: 3, 570753635: 3, 570812582: 3, 571336201: 3, 572188326: 3, 572827174: 3, 573326011: 3, 573730815: 5, 575663768: 3, 575894819: 3, 577768127: 3, 578723192: 5, 580295730: 3, 580404346: 5, 581170568: 5, 581214092: 3, 582438098: 3, 585210463: 3, 587776630: 1, 587990445: 3, 588493080: 3, 589379492: 3, 589433603: 3, 589587926: 3, 592622226: 3, 594249711: 3, 595218853: 3, 596981416: 3, 597562440: 1, 597704754: 3, 598070237: 5, 599685453: 3, 600203633: 5, 600857512: 3, 602556967: 5, 603563194: 6, 604034367: 3, 606925302: 3, 607232921: 3, 609235242: 3, 609960916: 3, 610210079: 3, 611726181: 3, 611861279: 3, 613236935: 3, 614298804: 3, 614309504: 3, 614439750: 3, 616364645: 3, 617220276: 5, 618285492: 3, 619257212: 1, 620462167: 5, 621152344: 3, 622469280: 5, 623310353: 1, 624361585: 3, 624736159: 3, 626708561: 5, 626873556: 3, 630311554: 3, 632935078: 5, 633836306: 3, 634930584: 3, 635390638: 5, 635486111: 3, 635684687: 3, 636682517: 3, 636824407: 1, 637292650: 3, 637414126: 3, 638275750: 3, 639001083: 5, 640550871: 3, 641009897: 3, 641076049: 3, 641732098: 3, 642384826: 5, 643031421: 6, 646114300: 3, 646806893: 3, 647356971: 3, 648341768: 3, 648481610: 3, 649706596: 3, 650023879: 3, 651931712: 3, 652320197: 3, 652890063: 3, 653328354: 5, 653889168: 3, 654323420: 3, 657589677: 3, 657883324: 5, 658104996: 3, 658410136: 3, 659492917: 1, 659920128: 5, 660250453: 3, 660772955: 1, 660788895: 3, 661317587: 3, 661452618: 5, 662410609: 5, 662493411: 3, 663968495: 3, 664587178: 3, 664663802: 3, 665300582: 3, 666704798: 3, 667433294: 3, 668785125: 5, 669566987: 3, 669845196: 3, 671059988: 3, 671188459: 3, 671691886: 3, 672496232: 3, 674088463: 1, 674947916: 3, 677560914: 3, 678577726: 3, 678692340: 5, 680667746: 3, 681783073: 3, 681864831: 3, 682668562: 3, 683097382: 3, 684413071: 3, 684786330: 5, 686363383: 3, 686680422: 3, 687680533: 3, 688937899: 5, 690719033: 3, 691554319: 3, 691961099: 3, 692858048: 3, 694870667: 3, 696124016: 3, 696804301: 6, 698718819: 5, 699049416: 3, 701871979: 3, 703852744: 3, 704165711: 3, 704827220: 3, 706970868: 3, 709236401: 3, 709954929: 3, 710458530: 3, 710960903: 3, 711671135: 3, 711937752: 3, 712589405: 6, 713178447: 3, 714753511: 3, 714875456: 3, 714891571: 3, 717926074: 3, 718146894: 3, 719634424: 3, 719738516: 3, 720926792: 3, 721058035: 5, 721323745: 3, 721609614: 5, 721719265: 3, 722489570: 3, 722569894: 3, 723169307: 5, 723219808: 5, 724521520: 5, 724807278: 3, 726033952: 3, 728306152: 3, 729069509: 3, 730282223: 3, 732754699: 5, 734139409: 3, 734194242: 3, 734936532: 3, 735302216: 3, 735361027: 3, 735706984: 3, 736264668: 3, 738721771: 3, 739057918: 3, 740309710: 3, 743196762: 3, 743789777: 3, 747023305: 3, 747113061: 3, 748076402: 3, 748211386: 3, 748341402: 5, 748354891: 3, 749428483: 3, 750267491: 5, 750634798: 3, 754841574: 3, 755221960: 3, 755260371: 3, 755691285: 3, 758671516: 3, 758910080: 3, 759551056: 3, 761248887: 3, 762895131: 5, 763564238: 3, 766387353: 3, 767218130: 5, 767310784: 3, 769649470: 3, 770538554: 3, 770908364: 3, 771112688: 3, 772982297: 3, 775696988: 3, 776026847: 5, 777639069: 3, 778000907: 3, 778613871: 5, 780551182: 3, 781486524: 3, 782501493: 3, 783236435: 3, 783548123: 3, 783615527: 3, 784212886: 5, 785916107: 3, 785983678: 3, 787129233: 3, 788056436: 3, 788730472: 3, 790378327: 3, 790456644: 5, 791315469: 5, 793892705: 3, 794239543: 3, 794700720: 5, 795888705: 3, 797015676: 3, 797030828: 3, 797575402: 5, 798582430: 3, 798611929: 3, 801079612: 3, 801304563: 3, 801863641: 3, 802690310: 5, 804109141: 3, 804445908: 3, 804623809: 3, 804990761: 6, 805537213: 3, 806925260: 5, 812135378: 5, 812458614: 3, 813552217: 3, 813577344: 3, 814137944: 3, 816200368: 3, 816564192: 3, 817068096: 3, 818217407: 5, 818803474: 5, 819773736: 3, 820620029: 3, 821326207: 3, 822041365: 3, 825598150: 3, 827702407: 3, 828762896: 3, 829210890: 3, 830547077: 5, 831233731: 3, 831778498: 3, 832830531: 5, 832981087: 3, 833559906: 3, 834507213: 3, 834903995: 3, 835981566: 3, 836231050: 3, 837618395: 6, 841187384: 3, 841292279: 3, 841313888: 3, 841591253: 3, 841838476: 3, 842387581: 3, 844134873: 3, 846003292: 5, 846915565: 3, 848038937: 3, 848780132: 5, 850285776: 5, 850695588: 3, 851893423: 3, 852167160: 3, 853057833: 3, 853466888: 3, 855302371: 3, 857016174: 3, 857626028: 3, 858417093: 5, 858768337: 5, 859073020: 5, 861420728: 3, 861690823: 6, 861885853: 3, 863128057: 3, 865204979: 3, 865711410: 3, 866980681: 3, 867391778: 1, 867834108: 3, 868810239: 3, 871075269: 5, 872244212: 3, 873810198: 3, 874307332: 5, 874672133: 3, 874837364: 5, 875485379: 5, 876195859: 3, 876823631: 3, 877251759: 3, 877385005: 5, 878391378: 3, 878743256: 5, 878825795: 3, 879263847: 5, 879268814: 5, 879321636: 3, 880550683: 3, 880916019: 3, 882043266: 3, 882608002: 3, 882708725: 5, 884212836: 3, 884653430: 3, 885086792: 5, 886655463: 3, 889653518: 3, 890724110: 3, 891456541: 3, 891807518: 3, 893238246: 5, 893740186: 3, 894634581: 3, 899533146: 3, 900511672: 3, 902166212: 5, 902166414: 3, 902349826: 3, 903800647: 5, 904668800: 3, 906932033: 3, 907530572: 3, 907674886: 3, 907917134: 3, 908595758: 3, 909273540: 3, 909466638: 3, 911527332: 3, 912251137: 3, 912546048: 3, 914497313: 3, 915120325: 3, 915479770: 3, 916921556: 5, 917596317: 3, 919878046: 5, 919981206: 3, 921018572: 3, 922057368: 3, 922399338: 3, 922562649: 5, 923497514: 3, 924580956: 3, 924809090: 3, 927682589: 3, 928391802: 3, 929151691: 3, 931488988: 3, 932818113: 3, 932944568: 5, 933487713: 3, 935005622: 6, 935863068: 3, 936757686: 3, 938696955: 3, 940700418: 5, 942665434: 3, 944345718: 5, 944399452: 3, 944872097: 3, 945906001: 6, 946021548: 5, 946897172: 3, 947035973: 3, 947786756: 1, 948556870: 3, 948717480: 1, 949111849: 3, 950401112: 3, 951160643: 5, 952287581: 3, 952449358: 3, 952758494: 3, 953567392: 3, 954628547: 3, 954867222: 5, 954976932: 3, 955350468: 3, 955624409: 3, 956341441: 3, 958698148: 3, 958788870: 3, 960631959: 6, 961172915: 1, 961779139: 5, 961936378: 3, 962837418: 3, 963269966: 3, 963759359: 3, 964443982: 3, 965575086: 3, 966701833: 3, 966737943: 3, 967000103: 3, 967242186: 5, 969874781: 3, 971239727: 3, 972112824: 3, 973847556: 3, 977301099: 3, 977396909: 3, 977434512: 3, 977714259: 3, 978332023: 3, 979008955: 3, 980045920: 3, 980526752: 3, 981990704: 6, 981998750: 3, 982224461: 3, 982974856: 3, 983311458: 3, 985003562: 3, 985252347: 5, 985278164: 3, 985611878: 3, 990521333: 3, 990778892: 5, 992049513: 3, 992141351: 3, 992556983: 3, 993457363: 3, 993637147: 5, 993945778: 3, 994277047: 3, 994926972: 5, 995477079: 3, 996880011: 3, 997105971: 3, 997470374: 3, 998825357: 3, 998940128: 3, 999606622: 3}

function randomizeWaifu(selector, start_dressed, shift, top_margin) {
    let girl = Object.keys(waifu_list)[Math.floor(Math.random() * Object.keys(waifu_list).length)]
    let img = 0
    if (!start_dressed) {
        img = Math.floor(Math.random()*(waifu_list[girl]+1));
    }
    document.querySelector(selector).setAttribute("src", "".concat(img_URI, girl.toString(), "/ava", img.toString(), ".png"));
    if (shift) {
        shiftUp(selector, shift, top_margin);
    }

    return;
}

function cycleWaifu(event, selector, shift, top_margin) {
    event.preventDefault();
    let girlElement = document.querySelector(selector);

    let match = girlElement.getAttribute("src").match(/.*girls\/([0-9]*)\/ava([0-9])([\.-])(.*)/);//[\.-].*/);
    let girl = match[1];
    let delta = 1;
    if (event.deltaY < 0) {
        delta = -1;
    }
    let img = Math.min(Math.max(parseInt(match[2]) + delta, 0), waifu_list[girl]);
    let final_URI = "".concat(img_URI, girl.toString(), "/ava", img.toString(), match[3]+match[4])
    girlElement.setAttribute("src", final_URI);
    if (shift) {
        shiftUp(selector, shift, top_margin);
    }
}

function shiftUp(selector, max_shift, top_margin) {
    let res = 0;

    let girlElement = document.querySelector(selector);

    let canvas = document.createElement("canvas");
    canvas.width = girlElement.width;
    canvas.height = girlElement.height;
    let ctx = canvas.getContext("2d", "willReadFrequently");

    girlElement.setAttribute("crossOrigin", "Anonymous");
    girlElement.onload = () => {
        ctx.drawImage(girlElement, 0, 0, girlElement.width, girlElement.height);
        var imgData = ctx.getImageData(0, 0, girlElement.width, girlElement.height);
        var n_rays = 8;
        var interval = girlElement.width * 4 / n_rays;
        for (let i = 0; i < imgData.data.length/interval; i++) {
            if (imgData.data[i*interval+3]) {
                res = Math.floor(-i/n_rays) + top_margin;
                break;
            }
        }
        girlElement.style.marginTop = Math.max(res, -max_shift).toString() + "px";
    }

}

const onElementLoaded = async selector => {
      while ( document.querySelector(selector) === null) {
        await new Promise( resolve => requestAnimationFrame(resolve) );
        console.log("going and");
      }
      return document.querySelector(selector);
}

const onElementComplete = async selector => {
      while ( document.querySelector(selector).complete === false) {
        await new Promise( resolve => requestAnimationFrame(resolve) );
        console.log("going and");
      }
      return document.querySelector(selector);
}

function addEventListeners(page_maps, randomize_at_start, start_dressed, clickrandomize, cycle, max_shift, top_margin) {
    for (const item in page_maps) {
        let page = page_maps[item].page;
        let selectors = page_maps[item].selectors;
        for (const i in selectors) {
            let selector = selectors[i];
            console.log(item, page, selectors, selector);
            if (document.querySelector(page_selector).getAttribute("page") == page) {
                if (randomize_at_start) { onElementLoaded(selector).then( () => {randomizeWaifu(selector, start_dressed, max_shift, top_margin);}) }
                else {shiftUp(selector, max_shift, top_margin);}

                if (clickrandomize) { onElementLoaded(selector).then( () => {document.querySelector(selector).addEventListener("click", () => randomizeWaifu(selector, start_dressed, max_shift, top_margin));}) }
                if (cycle)          { onElementLoaded(selector).then( () => {document.querySelector(selector).addEventListener('wheel', () => cycleWaifu(event, selector, max_shift, top_margin))}); }
            }
        }
    }
}

const zip = (a, b) => Array.from(Array(Math.max(b.length, a.length)), (_, i) => [a[i], b[i]]);


(function() {
    'use strict';

    onElementLoaded(page_selector).then(() => {
        addEventListeners([{page: "home",
                            selectors: [waifu_selector]}],
                          waifu_randomize_on_start, waifu_start_dressed, waifu_randomize_on_click, waifu_cycle_on_scroll, 345, 30);
        addEventListeners([{page: "activities",
                            selectors: [popup_selector_activities]}],
                          other_randomize_on_start, other_start_dressed, other_randomize_on_click, other_cycle_on_scroll, 160, 10);
        addEventListeners([{page: "quest",
                            selectors: [popup_selector_no_energy_quest]},
                           {page: "troll-pre-battle",
                            selectors: [popup_selector_no_energy_fight]}],
                          other_randomize_on_start, other_start_dressed, other_randomize_on_click, other_cycle_on_scroll, 0, 0);
        addEventListeners([{page: "shop",
                            selectors: market_selectors}],
                          other_randomize_on_start, other_start_dressed, other_randomize_on_click, other_cycle_on_scroll, 0, 0);
        addEventListeners([{page: "world",
                            selectors: [world_girl_selector]}],
                          false, true, other_randomize_on_click, other_cycle_on_scroll, 0, 0);


        if (["champions", "club_champion"].includes(document.querySelector(page_selector).getAttribute("page"))) {
            onElementLoaded(champions_selector).then( () => {document.querySelector(champions_selector).style.pointerEvents = 'all';
                                                             document.querySelector(champions_selector).addEventListener('wheel', () => cycleWaifu(event, champions_selector, 0, 30))});
        }
        if (["season-battle", "league-battle", "pantheon-battle", "troll-battle"].includes(document.querySelector(page_selector).getAttribute("page"))) {
            for (let i = 1; i < 8; i++) {
                let opp_selector = battle_girl_selector_opp+i.toString();
                onElementLoaded(opp_selector).then( () => {document.querySelector(opp_selector).addEventListener('wheel', () => cycleWaifu(event, opp_selector, 0, 30));}
                                              );
                let player_selector = battle_girl_selector_player+i.toString();
                onElementLoaded(player_selector).then( () => {document.querySelector(player_selector).addEventListener('wheel', () => cycleWaifu(event, player_selector, 0, 30));}
                                              );
            }
        }
        if (document.querySelector(page_selector).getAttribute("page") == "pantheon") {
            for (let i = 1; i < 8; i++) {
                let selector = pantheons_selector+i.toString() + " > img";
                onElementLoaded(selector).then( () => {document.querySelector(selector).addEventListener('wheel', () => cycleWaifu(event, selector, 0,30));}
                                              );
            }
        }

   });

})();
